@(pageTitle: String = "", stok:Option[controllers.StateOk]=None, page:Option[razie.wiki.model.WikiEntry]=None, options:Map[String,String]=Map())(implicit moreMetas:Map[String,String]=Map.empty, au:Option[model.User], request:Option[Request[_]] = None)
@import razie.wiki.model.WikiReactors
@import razie.wiki.Services
@import model.Website

@props() = @{
  request.flatMap(model.Website.apply(_))
}

@title() = @{
  if(pageTitle.length==0)
    stok.map(_._title).getOrElse(props.flatMap(_.title) getOrElse ("Wiki"))
  else pageTitle
}

@css() = @{
  stok.getOrElse(new controllers.StateOk("", au, request)).css
}

@reactor=@{
  stok.map(_.realm).orElse(request.map(r=>Website.realm(r))).orElse(page.map(_.wid.getRealm)).getOrElse("")
}


<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    @*** keep google happy using Admin:urlcanon ***@
    @page.flatMap(p=> Services.config.urlcanon(p.wid.wpath, page.map(_.tags))).map {canon =>
        <!-- canon -->
      <link rel="canonical" href="@canon" />
    }.getOrElse{
      @if(page.isDefined) {
        @** i should be conservative and default to rk **@
          <!-- page -->
        <link rel="canonical" href="@hostNameForRealm/@page.get.wid.canonpath" />
      }
    }

@hostNameForRealm=@{
  WikiReactors(page.get.wid.getRealm).websiteProps.prop("url").getOrElse("http://www.racerkidz.com")
}

    <title>@title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    @request.flatMap(model.Website.apply(_)).toSeq.flatMap(_.metas).map{t=>
      <meta name="@t._1" content="@t._2">
    }

    @page.map{p=>
      @p.contentProps.filter(_._1.startsWith("meta.")).map { t =>
        <meta name="@t._1.substring(5)" content="@t._2">
      }
    }

    @page.flatMap(_.contentProps.get("meta.author")).map { d =>
      <meta name="author" content="@d">
    }

    @moreMetas.map { t =>
      <meta name="@t._1" content="@t._2">
    }

    <!-- RK scripts -->
<script>
var realm = '@reactor';
</script>
    <!-- todo optimize this - don't need teh entire file -->

    <!-- Le styles -->
    <link href="@routes.Assets.at("bootstrap-3.3.4/css/bootstrap.css")" rel="stylesheet">
    <link href="@routes.Assets.at("bootstrap-3.3.4/css/bootstrap-theme.css")" rel="stylesheet">
    <link href="@routes.Assets.at("bootstrap-3.3.4/css/bootstrap-light.css")" rel="stylesheet">
    @if(css.contains("dark")) {
      <link href="@routes.Assets.at("bootstrap-3.3.4/css/bootstrap-"+css+".css")" rel="stylesheet">
    }

@*******
    <script src="@routes.Assets.at("bootstrap-3.3.4/js/bootstrap-modal.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("bootstrap-3.3.4/js/bootstrap-transition.js")" type="text/javascript"></script>
********@

@if(Services.config.hostport.startsWith("test") || Services.config.hostport.startsWith("xlocalhost")) {
  @if(css.contains("light")) {
    <style type="text/css">
      .navbar-inner {
        background-color: red;
  background-image: -moz-linear-gradient(top, #8a0808, #b40404);
  background-image: -ms-linear-gradient(top, #8a0808, #b40404);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#8a0808), to(#b40404));
  background-image: -webkit-linear-gradient(top, #8a0808, #b40404);
  background-image: -o-linear-gradient(top, #8a0808, #b40404);
  background-image: linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#8a0808', endColorstr='#b40404', GradientType=0);
        }
    </style>
    } else {
    <style type="text/css">
.navbar .navbar-inner {
  background-color: #b40404;
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#8a0808), color-stop(70%, #b40404), to(#b40404));
  background-image: -webkit-linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-image: -moz-linear-gradient(top, #8a0808, #b40404 70%, #b40404);
  background-image: -o-linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-image: linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-repeat: no-repeat;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff8a0808', endColorstr='#ffb40404', GradientType=0);
}
    </style>
    }
}

    <!-- leave room for navbar but none at bottom (for gray links) -->
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 0px;
      }
      .error {
        color: red;
      }
    </style>

    <script src="@routes.Assets.at("javascripts/jquery-1.11.2.min.js")" type="text/javascript"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->

    @****
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
    ****@

<style type="text/css">
ul.like-buttons{
  float: left;
  list-style: none;
  margin: 5px 0 20px 0;
  padding: 0;
  width: 100%;
}
ul.like-buttons li{
  display: block;
  float: left;
  margin-right: 0px;
}
li.twitter-like{
  margin-top: 3px;
  margin-left: 0px;
}
li.g-like{
  margin-top: 3px;
}
</style>

@if(Services.config.isLocalhost) {
  <script type="text/javascript">
  var tstamp = @System.currentTimeMillis();
  var shouldReloadTimer = setInterval(function(){
    $.get("/razadmin/ping/shouldReload", function( data ) {
      if(data > tstamp) {
        tstamp = data;
        console.log("reloading...");
        location.reload();
      } else {
      }
    }).fail(function(){
      // on error, just backoff for a while
      clearInterval(shouldReloadTimer);
    });
  },2000);
</script>
}

@if(Services.config.analytics) {
  <script type="text/javascript">
  var xrazprop = (function() {
    var xp = {};

@**
    @model.Website.all.map{w=>
      @w.prop("analyticsId").map{t=>
        xp['@w.url'] = '@t';
      }
    }
**@

    @props.flatMap(_.prop("analyticsId")).map{t=>
      return '@t';
    }.getOrElse{
    @Services.config.config("analytics").toList.flatMap(_.toSeq).map {t=>
      xp['@t._1'] = '@t._2';
    }

    return xp[document.location.hostname] || 'UA-31808405-1';
    }

})();

    @** this is from google analytics tracking adsense from adsense integration **@
    window.google_analytics_uacct = xrazprop;

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', xrazprop]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

}

@*** for hijs code frags ***@

@** nots needs without this if
 @if(page.exists(p=>"""\{\{code[:}]""".r.findFirstIn(p.content).isDefined)) { **@

  @if(css.contains("light")) {

<style type="text/css">
# this makes all look big, even `something`
#p code {
#  font-size: 16px;
# line-height: 16px;
#}#

## this is for hijs.js / hiscala / hidiesel
pre {
  background-color: #e5e5e5;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: #000000;
}
code .keyword              { font-weight: bold; color: #993300 }
code .string, code .regexp { color: #669933 }
code .class                { color: #CC6600 }
code .special              { color: #dd7522 }
code .number               { color: #669933 }
code .comment              { color: gray }
</style>

} else {              @*** dark theme ***@

<style type="text/css">
# this makes all look big, even `something`
#p code {
#  font-size: 16px;
#  line-height: 16px;
#}

pre {
  background-color: black;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: #DDDDDD
}
code .keyword              { font-weight: bold; color: #FFCC00 }
code .string, code .regexp { color: #669933 }
code .class                { color: #C39A5E }
code .special              { color: #dd7522 }
code .number               { color: #eddd3d }
code .comment              { color: gray }
</style>
}

@** style for the bottom footer gray band *@
<style>
    strong.razbots {
    color:lightgray;
    padding-bottom: 5px;
    border-bottom: 5px solid #444;
    line-height:50px;
    font-size:18px;
    font-family:Verdana;
    }
    a.razbot {
    color:#0088cc;
    text-decoration:none;
    font-size:16px;
    line-height:30px;
    font-weight:normal;
    font-family:Verdana;
    }
</style>

@**}**@

<style type="text/css">
img.rklogo {
  opacity:0.8;
  filter:alpha(opacity=80); /* For IE8 and earlier */
}
</style>

<style>
.ace-primaryline {
  background-color: yellow;
  position:absolute;
}
</style>


</head>

@options.get("onload").map{f=>
  <body onload="@f">
}.getOrElse{
  <body>
}
