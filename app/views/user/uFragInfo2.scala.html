@(user: model.User, item:Int)

@*******
included in mainUserC as the right hand side info box 
*********@

@import org.joda.time.DateTime
@import razie.RString._
@import controllers.XListWrapper
@import controllers.Wiki

@active(i:Int) = @{
  if(i == item) "active" else ""
}

@locs() = @{
  {controllers.UserStuff.xp(user, "Calendar") \ "Race" \ "Venue" \@ "loc"}.filter(! _.isEmpty).map(_.replaceFirst("ll:",""))
}

<div class="span6">
    <div class="well">

<ul class="nav nav-tabs">
  <li class="@active(1)"><a href="/doe/index/1">Calendar</a></li>
  <li class="@active(2)"><a href="/doe/index/2">Map</a></li>
  <li class="@active(3)"><a href="/doe/index/3">Blogs</a></li>
  <li class="@active(4)"><a href="/doe/index/4">Notes</a></li>
</ul>

@item match {
  case 1 => {
    @if(user.tasks.size>0) {
      <b>Stuff to do</b>
      <ul>
      @for(t <- user.tasks) {
        <li><a href="/user/task/@t.name">@t.desc</a></li>
      }
      </ul>
    } else {
      <b>No tasks.</b>
    }
    <p>
    @if(user.events.filter(_._3.isBefore(DateTime.now)).size>0) {
      <b>Recent events:</b>
      <ul>
      @for(t <- user.events.filter(_._3.isBefore(DateTime.now)).takeRight(3)) {
        <li>@Html(model.Wikis.formatWikiLink(t._1.wid,t._1.wid.name, t._2,Some(t._1.label))._1)
        @if(t._4.wid.name != null && t._4.wid.name.length>0) {
          at @Html(t._4.format._1)
        }
        </li>
      }
      </ul>
    } else {
    }
    <p>
    @if(user.events.filter(_._3.isAfter(DateTime.now)).size>0) {
      <b>Coming up:</b>
      <ul>
      @for(t <- user.events.filter(_._3.isAfter(DateTime.now)).take(5)) {
        <li>@Html(model.Wikis.formatWikiLink(t._1.wid,t._1.wid.name,t._2,Some(t._1.label))._1)
        @if(t._4.wid.name != null  && t._4.wid.name.length>0) {
          at @Html(t._4.format._1)
        }
        </li>
      }
    @if(user.events.filter(_._3.isAfter(DateTime.now)).size>5) {
      <li>...</li>
    }
      </ul>
    } else {
     <b>Nothing coming up...</b>
    }
            
@*********
    <a href="http://maps.googleapis.com/maps/api/staticmap?zoom=13&size=600x300&sensor=false&@locs().map(x=>"markers=color:red|%s".format(x, x)).mkString("&")">map</a>
    <a href="http://maps.googleapis.com/maps/api/staticmap?zoom=13&size=600x300&@user.events.filter(_._3.isAfter(DateTime.now)).map(x=>(x._4, x._4.tags.get("loc"))).filter(_._2.isDefined).map(x=>"markers=color:red|label:%s|%s".format(x._1.label, x._1.tags.get("loc"))).mkString("&")">map</a>
********@
  }

case 2 => {
  
  @util.utilMap(
      (controllers.UserStuff.xp(user, "Calendar") \ "Race" \ "Venue").asInstanceOf[XListWrapper[_]],
      user.ll
      )
  }

case 3 => { 

  Owned: 
  @if(user.pages("Blog").filter(_.role == "Owner").size>0) {
  <a class="btn btn-mini" href="/wiki/Blog">Add &raquo;</a></p>
  <ul> 
    @for(w <- user.pages("Blog").filter(_.role == "Owner")) {
      <li><a href="@controllers.Wiki.w(w.wid)">@model.Wikis.label(w.wid)</a></li>
    }
  </ul>
} else {
  None
  <a class="btn btn-mini" href="/wiki/Blog">Create one &raquo;</a></p>
}
<p>
  Followed:
  @if(user.pages("Blog").filter(_.role != "Owner").size>0) {
  <ul> 
    @for(w <- user.pages("Blog").filter(_.role != "Owner")) {
      <li><a href="@controllers.Wiki.w(w.wid)">@model.Wikis.label(w.wid)</a></li>
    }
  </ul>
  } else {
    None
    <a class="btn btn-mini" href="/wiki/Blog">Follow one &raquo;</a></p>
  }
  }

case 4 => { 

  Owned: 
  @if(user.pages("Note").filter(_.role == "Owner").size>0) {
  <a class="btn btn-mini" href="/wiki/Note">Add &raquo;</a></p>
  <ul> 
    @for(w <- user.pages("Note").filter(_.role == "Owner")) {
      <li><a href="@controllers.Wiki.w(w.wid)">@model.Wikis.label(w.wid)</a></li>
    }
  </ul>
  } else {
    None
    <a class="btn btn-mini" href="/wiki/Note">Create one &raquo;</a></p>
  }
  }

}
            </div>
          </div>
          