@(wid:model.WID, user:Option[model.User], simple:Boolean = false, page:Option[model.WikiEntry]=None, iname:Option[String]=None, noTitle:Boolean=false)

@nicename() = @{
  iname.getOrElse(wid.name)
}

@cat() = @{
  wid.cat
}

@w(c:String) = @{
  if(page.isDefined) page else model.Wikis.find(c,wid.name)
}

@ww() = @{
  model.Wikis.findAny(wid.name)
}

@one(page:Option[model.WikiEntry]) = {
  @page match {
    case Some(we) => { 
      @if(!simple && !noTitle) {
        @cat match {
          case "any" => {
              <h2>@wid.name</h2>
            } 
          case "Category" => {
              <h2>@model.Wikis.label(wid) (Category)</h2>
            } 
          case _ => {
              <h2>@model.Wikis.label(wid)</h2>
           }
         }
      }
      
      <p>@Html(model.Wikis.format(we.wid, we.markup, we.content, page))</p> 
        
        @if(!simple) {

          @if(page.isDefined && page.get.tags.size>0) {
            <p><small><em>Tags</em>:  @page.get.tags.mkString(", ")</small>
          }
          
      @wid.findParent.map {pwe=>
        <hr>
        Up to: <a href="@controllers.Wiki.w(pwe.wid)">@pwe.label</a> 
      }

      <hr>
      @page.flatMap(x=>model.WikiCount.findOne(x._id)).map {pw=>
        <p><small>Viewed <b>@pw.count</b> times</small>
      }
<small>(
      @if(controllers.Wiki.canEdit2(wid,user, page)) { 
        <a href="@routes.Wiki.wikieEdit(page.get.wid)">Edit</a> | 
      }
      <a href="@routes.Wiki.report(wid)">Report</a> 
      @if(!(Array("WikiLink", "Category") contains cat)) {
        @if(controllers.Wiki.canEdit2(wid,user, page)) { 
          | <a href="@routes.Wiki.wikieRename1(wid)">Rename</a> 
        }
        @if(user.exists(_.hasPerm(model.Perm.adminDb))) { 
          | <a href="@routes.Wiki.wikieDebug(wid)"><i>debug</i></a> 
        }
        @if(user.isDefined && user.get.isActive) { 
          @if(user.get.pages(wid.cat).find(_.wid.name == wid.name).isDefined) {
          | <a href="@routes.Wiki.unlinkUser(wid)">Unlike</a> 
          } else {
          | <a href="@routes.Wiki.linkUser(wid,false)">Like</a> 
        }
        }
      }
      ) this page.
      @cat match {
        case "WikiLink" if(wid.name.startsWith("User:")) => {
          <br>This link page connects you to 
          <a href="/wiki/@model.Wikis.linkFromName(wid.name).to.toString">@model.Wikis.linkFromName(wid.name).to.name</a> 
          : you can add some notes by <a href="@routes.Wiki.wikieEdit(page.get.wid)">editing</a> it.
        }
      case "Category" => {
          <br>You cannot edit categories.
      }
      case _ => {
          <br>This content is Copyrighted, all rights reserved.
      }
      }
} <!-- /simple -->

      </small></p>
      }
    case None => { 
    @if("any" != cat && !cat.isEmpty) {
      <b>No entry matching @cat and @wid.name ... <a href="@routes.Wiki.wikieEdit(model.WID(cat,nicename))">create one</a></b> 
    } else {
      <b>No entry for @wid.name ... you could create one:</b>
      <form action="@routes.Wiki.edit2" method="GET" class="well form-inline">
        <input type="text" name="name" id="name" value="@nicename"> 
        <select id="cat" name="cat" class="input-small">
          @model.Wikis.pageNames("Category").toList.sortWith(_ < _).map{x=>
            <option value="@x" >@x</option>
          }
       </select>

     <button type="submit" class="btn btn-primary">Create</button>
     </form>
      }
    }
  }
} 

@many() = {
Multiple options:
<ul>
  @ww.map { we => 
    <li><a href="@controllers.Wiki.w(we.category, we.name)">@we.category @we.name</a></li>
  }
</ul>
} 

@{
page match {
  case Some(x) => one(w(x.category))
  case None => cat match {
    case "any" => { 
      if(ww.size >= 1) many
      else if(ww.size == 1) ww.map ( x=> one(w(x.category)) )
      else one(None)
      }
    case _ => one(w(cat)) 
    }
  }
}

