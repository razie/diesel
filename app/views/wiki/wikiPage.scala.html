@(cat:String, name:String, iname:Option[String], page:Option[model.WikiEntry], user:Option[model.User])
@import model._

@comments(stream:Option[CommentStream]) = {
  @stream match {
    case None => {}
    case Some(stream) => {
  There's @stream.comments.size comment(s)...
  <p>

  @stream.comments.map { c =>
    <div class="well">
      <b>By: <a href="/user/@model.Users.nameOf(c.userId)">@model.Users.nameOf(c.userId)</a></b>
@*********
&nbsp;    <a href="/wikie" class="btn btn-mini">Reply</a>
**********@
       &nbsp; <a href="" class="btn btn-mini btn-info">Report</a>
@if(controllers.Comment.canEdit(c,user)) {
       &nbsp; <a href="@routes.Comment.edit(cat,name,c._id.toString)" class="btn btn-mini btn-info">Edit</a>
}
      <br>
      <br>
      @Html(model.Wikis.format("md", c.content))
    </div>
    }
    }
  }
}

   @htmlHead(cat +":"+ name)

   @navbar(user)
   
    <div class="container">
        <div class="row">

    <div class="span9">

      <div class="well">
          @wiki.wikiFrag(cat,name,false,page, iname)
      </div>

    <!-- list of pages in category -->
    @if("Category" == cat && "User" != name && "WikiLink" != name && ("Hidden" != name || user.map(_.hasPerm(Perm.adminDb)).getOrElse(false))) {
      <div class="well">
        @name entries:
        @model.Wikis.pageNames(name).take(80).map { p=>
          <a href="/wiki/@name:@p">@model.Wikis.label(name,p)</a> |
        } 
      </div> 

      @helper.form(action=routes.Wiki.add(name), 'class->"well form-inline") {
        <label>Add a new @name </label>
        <input type="text" class="input-xlarge" name="name" placeholder="Name">
        <button type="submit" class="btn">Now</button>
      }
    } 

@comments(page.flatMap(p=>model.Comments.findForWiki(p._id)))

@*********
ain't working...
<div class="modal" id="modalReply">
  <div class="modal-header">
    <button class="close" data-dismiss="modal">x</button>
    <h3>Modal header</h3>
  </div>
  <div class="modal-body">
    <p>One fine body…</p>
  </div>
  <div class="modal-footer">
    <a href="#" class="btn">Close</a>
    <a href="#" class="btn btn-primary">Save changes</a>
  </div>
</div>
**********@

  @if(user.isDefined) {
    @if(page.map(_.isReserved).getOrElse(true)) {
      You can't comment on reserved pages, sorry!
    } else {
      @if(!user.get.canHasProfile) {
        You can't comment on public pages, sorry!
      } else {
        @helper.form(action=routes.Comment.add(page.get._id.toString,"Wiki",{new com.mongodb.casbah.Imports.ObjectId().toString}), 'class->"well form-inline") {
          <label>Add a new comment </label><br>
          <textarea id="content" class="span6" name="content" placeholder="content" rows="5"></textarea>
          <button type="submit" class="btn btn-primary" onclick="$(this).addClass('disabled');">Now</button>
          }
        } 
      } 
    } else {
      You need to log in to post a comment, sorry!
  }
  
      <hr>
      @htmlFooter()

    </div> <!-- /span9 -->

      <div class="span3">
          @wiki.wikiFrag("Page","Right",true, None)
      </div>

      </div> <!-- row -->

    </div> <!-- /container -->

    @htmlBottom()
    