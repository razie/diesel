@**************
debug a wiki page
**************@

@(wid:model.WID, iname:Option[String], page:Option[model.WikiEntry], au:Option[model.User])
@import model._

@comments(stream:Option[CommentStream]) = {
  @stream match {
    case None => {}
    case Some(stream) => {
  There's @stream.comments.size comment(s)...
  <p>

  @stream.comments.map { c =>
    <div class="well">
      <b>By: <a href="/user/@model.Users.nameOf(c.userId)">@model.Users.nameOf(c.userId)</a></b>
@*********
&nbsp;    <a href="/wikie" class="btn btn-mini">Reply</a>
**********@
       &nbsp; <a href="" class="btn btn-mini btn-info">Report</a>
@if(controllers.Comment.canEdit(c,au)) {
       &nbsp; <a href="@routes.Comment.edit(wid,c._id.toString)" class="btn btn-mini btn-info">Edit</a>
}
      <br>
      <br>
      @Html(model.Wikis.format(page.map(_.wid).getOrElse(model.WID("?","?")), "md", c.content))
    </div>
    }
    }
  }
}

@htmlHeadBar(wid.cat +":"+ wid.name, au)

    <div class="container">
        <div class="row">

    <div class="span9">

      <div class="well">
          @wiki.wikiFrag(wid,au,false,page, iname)
      </div>

    <!-- list of pages in category -->
      <div class="well">
        <ul>tags
        @page.get.tags.map { p=>
          <li>@p</li>
        } 
       </ul>
      </div> 

      <div class="well">
        <ul>contentTags
        @page.get.contentTags.map { p=>
          <li>@p</li>
        } 
       </ul>
      </div> 

      <div class="well">
        <ul>ilinks
        @page.get.ilinks.map { p=>
          <li>@p</li>
        } 
       </ul>
      </div> 

      <div class="well">
        <ul>followers: userWikis
        @model.Users.findUserLinksTo(page.get.uwid).toList.map { uw=>
          <li>@model.Users.findUserById(uw.userId).map(_.userName).getOrElse(uw.userId) , @uw.role</li>
        } 
       </ul>
      </div> 

      <div class="well">
        <ul>external followers
        @model.Users.findFollowerLinksTo(page.get.uwid).toList.flatMap(_.follower).map {f=>
          <li>@model.Enc.unapply(f.email)</li>
        } 
       </ul>
      </div> 

      <div class="well">
        <ul>props
        @page.get.props.map { p=>
          <li>@p</li>
        } 
       </ul>
      </div> 
      
      <div class="well">
      @helper.form(action=routes.Wikie.uowner(page.get.wid), 'class->"well form-inline") {
        <input type="text" class="input-large" name="newowner" placeholder="@page.map(_.owner)">
        <button type="submit" class="btn">Update Owner</button>
      }
      </div> 
      <div class="well">
        <ul>sections
        @page.get.sections.map { p=>
          <li>@p</li>
        } 
       </ul>
      </div>

      <div class="well">
        <ul>fields
          @page.get.fields.map { p=>
            <li>@p</li>
          }
        </ul>
        <p>
        @page.get.fields.map { p=>
          @p._1,
        }
      </div>

      <div class="well">
        <ul>cache
        @page.get.cache.map { p=>
          <li>@p.toString</li>
        } 
       </ul>
      </div>

      <div class="well">
        <ul>cp
@ClassLoader.getSystemClassLoader.asInstanceOf[java.net.URLClassLoader].getURLs.map { p=>
  <br>
@p.getFile
} 
       </ul>
      </div> 

      <div class="well">
      Versions:<p>
      <table class="table table-striped table-condensed">
         <thead><th>ver</th><th>content</th><th> date </th><th> User </th></thead>
        @db.RMany[WikiEntryOld]("entry.category" -> page.get.category, "entry.name" -> page.get.name).map{ p=>
         <tr>
           <td> <a href="/wikie/ver/@p.entry.ver/@page.get.wid.wpath">@p.entry.ver</a> </td>
           <td> <a href="/wikie/content/ver/@p.entry.ver/@page.get.wid.wpath">@p.entry.ver</a> </td>
           <td> @p.entry.updDtm </td>
           <td> @db.ROne[User]("_id" -> p.entry.by).map(_.ename).getOrElse(p.entry.by.toString) </td>
         </tr>
         } 
       </table>
      </div> 

      <div class="well">
        @page.map{ p=>@p.toString } 
       </ul>
      </div> 

      <div class="well">
      @model.Wikis.format(wid, "md", page.get.content)
       </ul>
      </div> 

      <hr>
      @htmlFooter()

    </div> <!-- /span9 -->

      <div class="span3">
          @wiki.wikiFrag(WID("Admin","Right"),au,true)
      </div>

  </div> <!-- row -->
</div> <!-- /container -->

@htmlBottom()
    