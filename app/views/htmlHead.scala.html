@(pageTitle: String = "", cssr:Option[String]=None, page:Option[model.WikiEntry]=None, options:Map[String,String]=Map())(implicit moreMetas:Map[String,String]=Map.empty, au:Option[model.User], request:Option[Request[_]] = None)
@import _root_.admin.Config

@title() = @{
  if(pageTitle.length==0) Config.sitecfg("RacerKidz") getOrElse ("RacerKidz")
  else pageTitle
}

@css() = @{
  val ret = cssr.orElse(au.flatMap(_.css)).getOrElse(_root_.admin.Config.theme)
  if(ret == null || ret.length <=0) "light" else ret
}

<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    @*** keep google happy using Admin:urlcanon ***@
    @page.flatMap(p=> Config.urlcanon(p.wid.wpath, page.map(_.tags))).map {canon =>
      <link rel="canonical" href="@canon" />
    }.getOrElse{
      @if(page.isDefined) {
        @** i should be conservative and default to rk **@
        <link rel="canonical" href="http://www.racerkidz.com/wiki/@page.get.wid.wpath" />
      }
    }

    <title>@title</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    @Html(_root_.admin.Config.metas)

    @page.flatMap(_.contentTags.get("meta.description")).map { d =>
      <meta name="description" content="@d">
    }

    @page.flatMap(_.props.get("meta.author")).map { d =>
      <meta name="author" content="@d">
    }

    <!-- Le styles -->
    <link href="@routes.Assets.at("bootstrap/css/bootstrap-"+css+".css")" rel="stylesheet">

@*******
    <script src="@routes.Assets.at("bootstrap/js/bootstrap-modal.js")" type="text/javascript"></script>
    <script src="@routes.Assets.at("bootstrap/js/bootstrap-transition.js")" type="text/javascript"></script>
********@

@if(Config.hostport.startsWith("test") || Config.hostport.startsWith("xlocalhost")) {
  @if(Config.theme.contains("light")) {
    <style type="text/css">
      .navbar-inner {
        background-color: red;
  background-image: -moz-linear-gradient(top, #8a0808, #b40404);
  background-image: -ms-linear-gradient(top, #8a0808, #b40404);
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#8a0808), to(#b40404));
  background-image: -webkit-linear-gradient(top, #8a0808, #b40404);
  background-image: -o-linear-gradient(top, #8a0808, #b40404);
  background-image: linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-repeat: repeat-x;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#8a0808', endColorstr='#b40404', GradientType=0);
        }
    </style>
    } else {
    <style type="text/css">
.navbar .navbar-inner {
  background-color: #b40404;
  background-image: -webkit-gradient(linear, 0 0, 0 100%, from(#8a0808), color-stop(70%, #b40404), to(#b40404));
  background-image: -webkit-linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-image: -moz-linear-gradient(top, #8a0808, #b40404 70%, #b40404);
  background-image: -o-linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-image: linear-gradient(#8a0808, #b40404 70%, #b40404);
  background-repeat: no-repeat;
  filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ff8a0808', endColorstr='#ffb40404', GradientType=0);
}
    </style>
    }
}

    <!-- leave room for navbar but none at bottom (for gray links) -->
    <style type="text/css">
      body {
        padding-top: 60px;
        padding-bottom: 0px;
      }
    </style>
    <link href="@routes.Assets.at("bootstrap/css/bootstrap-responsive.css")" rel="stylesheet">

    <script src="@routes.Assets.at("javascripts/jquery-1.7.1.min.js")" type="text/javascript"></script>

    <!-- Le HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Le fav and touch icons -->
    
    @****
    <link rel="shortcut icon" href="../assets/ico/favicon.ico">
    <link rel="apple-touch-icon-precomposed" sizes="114x114" href="../assets/ico/apple-touch-icon-114-precomposed.png">
    <link rel="apple-touch-icon-precomposed" sizes="72x72" href="../assets/ico/apple-touch-icon-72-precomposed.png">
    <link rel="apple-touch-icon-precomposed" href="../assets/ico/apple-touch-icon-57-precomposed.png">
    ****@
    
<style type="text/css">
img.rklogo
  {
  opacity:0.8;
  filter:alpha(opacity=80); /* For IE8 and earlier */
  }
  
.navbar .rkbrand { /* this is a copy of the bootstrap .brand */
  float: left;
  display: block;
  padding: 4px 20px 1px;
  #padding: 11px 20px 11px;
  margin-left: -20px;
  font-size: 20px;
}

ul.like-buttons{
  float: left;
  list-style: none;
  margin: 5px 0 20px 0;
  padding: 0;
  width: 100%;
}
ul.like-buttons li{
  display: block;
  float: left;
  margin-right: 0px;
}
li.twitter-like{
  margin-top: 3px;
  margin-left: 0px;
}
li.g-like{
  margin-top: 3px;
}
</style>
  
@if(_root_.admin.Config.analytics) {
  <script type="text/javascript">
  var xrazprop = (function() {
    var xp = {};
    
    @Config.config("analytics").toList.flatMap(_.toSeq).map {t=>
      xp['@t._1'] = '@t._2';
    }
    
    return xp[document.location.hostname] || 'UA-31808405-1';
})();

    @** this is from google analytics tracking adsense from adsense integration **@
    window.google_analytics_uacct = xrazprop;

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', xrazprop]);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

</script>

}

@*** for hijs code frags ***@

@** nots needs without this if
 @if(page.exists(p=>"""\{\{code[:}]""".r.findFirstIn(p.content).isDefined)) { **@

  @if(Config.theme.contains("light")) {
  
<style type="text/css">
# this makes all look big, even `something`
#p code {
#  font-size: 16px;
# line-height: 16px;
#}#

pre {
  background-color: #e5e5e5;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: #000000; 
}
code .keyword              { font-weight: bold; color: #993300 }
code .string, code .regexp { color: #669933 }
code .class                { color: #CC6600 }
code .special              { color: #dd7522 }
code .number               { color: #eddd3d }
code .comment              { color: gray }
</style>

} else {              @*** dark theme ***@

<style type="text/css">
# this makes all look big, even `something`
#p code {
#  font-size: 16px;
#  line-height: 16px;
#}

pre {
  background-color: #191919;
  white-space: pre-wrap;
  word-wrap: break-word;
  color: #DDDDDD 
}
code .keyword              { font-weight: bold; color: #FFCC00 }
code .string, code .regexp { color: #669933 }
code .class                { color: #C39A5E }
code .special              { color: #dd7522 }
code .number               { color: #eddd3d }
code .comment              { color: gray }
</style>
}

@** style for the bottom footer gray band *@
<style>
    strong.razbots {
    color:lightgray;
    padding-bottom: 5px;
    border-bottom: 5px solid #444;
    line-height:50px;
    font-size:18px;
    font-family:Verdana;
    }
    a.razbot {
    color:#0088cc;
    text-decoration:none;
    font-size:16px;
    line-height:30px;
    font-weight:normal;
    font-family:Verdana;
    }
</style>

@**}**@
          
</head>

@options.get("onload").map{f=>
  <body onload="@f">
}.getOrElse{
  <body>
}
